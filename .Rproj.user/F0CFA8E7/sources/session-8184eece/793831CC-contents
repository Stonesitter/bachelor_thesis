# Calculate the reflection constant which is max + 1
reflection_constant <- max(merged_data$total_correct) + 1

# Reflect the data
merged_data$reflected_total_correct <- reflection_constant - merged_data$total_correct

# Plot to see the result of the reflection
hist(merged_data$reflected_total_correct, main = "Reflected Distribution of Total Correct", xlab = "Reflected Total Correct", col = "green")

# Apply the log transformation; add 1 to handle any zeros
merged_data$log_reflected_total_correct <- log(merged_data$reflected_total_correct + 1)

# Plot to see the result of the log transformation
hist(merged_data$log_reflected_total_correct, main = "Log Transformed Reflected Total Correct", xlab = "Log Reflected Total Correct", col = "red")


# Summary statistics
summary(merged_data$log_reflected_total_correct)

# Optional: Generate a Q-Q plot to evaluate normality
qqnorm(merged_data$log_reflected_total_correct)
qqline(merged_data$log_reflected_total_correct, col = "steelblue", lwd = 2)


model <- lm(log_reflected_total_correct ~ MMM_S_Index, data = merged_data)
summary(model)
par(mfrow = c(2,2))
plot(model)

model2 <- lm(log_reflected_total_correct ~ poly(MMM_S_Index_centered, 2), data = merged_data)
plot(model2)
summary(model2)
